blueprint:
  name: Automation Rolladen
  description: |
    # Rolladen
    Automation eines Rolladen abhängig von Werktag, Uhrzeit, Fensterstellung.

    Zur Aktivierung/Deaktivierung der Steuerung kann ein globaler Schalter definiert werden. 
    Das Hoch- und Runterfahren kann durch separate Schalter unterbunden werden. 

    Die Rahmenzeiten (frühestes und spätestes Öffnen und Schließen) werden durch Zeiteinträge definiert, 
    dazwischen wird die Bewegung durch die Variable "es ist Tag" gesteuert. Diese Variable kann durch 
    eine separate Automation den eigenen Wünschen entsprechend gesetzt werden.

    Link zum Repo [Github](https://github.com/cradermacher/ha-repo/blob/main/blueprints/shutter)

    Version 1.0
    Datum 04.10.2023
    source_url:https://github.com/cradermacher/ha-repo/blob/main/blueprints/automation/shutter/shutter.yaml




  domain: automation
  input:
    shutter:
      name: Rolladen
      description: Zu steuernden Rolladen auswählen
      selector:
        entity:
          domain: cover
          multiple: false
    workday:
      name: Werktag
      description: Entität die anzeigt ob ein Werktag ist
      selector:
        entity:
          domain: binary_sensor
          multiple: false
    day_night:
      name: Es ist Tag
      description: Entität die anzeigt ob es Tag oder Nacht ist
      selector:
        entity:
          domain: binary_sensor
          multiple: false
    active:
      name: Aktiv
      description: Entität zur Steuerung, ob die gesamte Automation ausgeführt werden soll
      selector:
        entity:
          domain: input_boolean
          multiple: false
    close_off:
      name: Automatisch Runterfahren ausschalten
      description: Entität, die verhindert, dass der Rolladen automatisch runterfährt
      selector:
        entity:
          domain: input_boolean
          multiple: false
    open_off:
      name: Automatisch hochfahren ausschalten
      description: Entität, die verhindert, das der Rolladen automatisch hochfährt
      selector:
        entity:
          domain: input_boolean
          multiple: false
    earliest_open_workday:
      name: Frühestes öffnen an Werktagen
      selector:
        entity:
          domain: input_datetime
          multiple: false
    earliest_open_non_workday:
      name: Frühestes öffnen an nicht Werktagen
      selector:
        entity:
          domain: input_datetime
          multiple: false
    latest_open_workday:
      name: Spätestes öffnen an Werktagen
      selector:
        entity:
          domain: input_datetime
          multiple: false
    latest_open_non_workday:
      name: Spätestes öffnen an nicht Werktagen
      sentity:
          domain: input_datetime
          multiple: false
    earliest_close_workday:
      name: Frühestes öffnen an Werktagen
      selector:
        entity:
          domain: input_datetime
          multiple: false
    earliest_close_non_workday:
      name: Frühestes öffnen an nicht Werktagen
      selector:
        entity:
          domain: input_datetime
          multiple: false
    latest_close_workday:
      name: Spätestes öffnen an Werktagen
      selector:
        entity:
          domain: input_datetime
          multiple: false
    latest_close_non_workday:
      name: Spätestes öffnen an nicht Werktagen
      selector:
        entity:
          domain: input_datetime
          multiple: false
    window_sensor:
      name: Fenstersensor
      description: Entität für die Ermittlung der Fensterstellung (offen, gekippt, geschlossen)
      selector:
        entity:
          domain: sensor
          multiple: false
    window_open_value:
      name: Rolladenstellung bei Fenster offen
      selector:
        number:
          min: 0
          max: 100
          unit_of_measurement: "%"
          mode: slider
          step: 1.0
    window_tilted_value:
      name: Rolladenstellung bei Fenster gekippt
      selector:
        number:
          min: 0
          max: 100
          unit_of_measurement: "%"
          mode: slider
          step: 1.0
    window_closed_value:
      name: Rolladenstellung bei Fenster geschlossen
      selector:
        number:
          min: 0
          max: 100
          unit_of_measurement: "%"
          mode: slider
          step: 1.0
    text_status:
      name: Statusausgabe
      description: Statusausgabe als Text, enthält die Information, was der letzte Auslöser war
      selector:
        entity:
          domain: input_text
          multiple: false
    mode:
      name: Modus
      description: Modusanzeige für den jeweiligen Rolladen (Tag/Nacht)
      selector:
        entity:
          domain: input_select
          multiple: false
trigger:
  - platform: time
    at: !input earliest_open_workday
    id: earliest_open_workday

  - platform: time
    at: !input earliest_open_non_workday
    id: earliest_open_non_workday

  - platform: time
    at: !input latest_open_workday
    id: latest_open_workday

  - platform: time
    at: !input latest_open_non_workday
    id: latest_open_non_workday

  - platform: time
    at: !input earliest_close_workday
    id: earliest_close_workday

  - platform: time
    at: !input earliest_close_non_workday
    id: earliest_close_non_workday

  - platform: time
    at: !input latest_close_workday
    id: latest_close_workday

  - platform: time
    at: !input latest_close_non_workday
    id: latest_close_non_workday

  - platform: state
    entity_id: !input day_night
    from: "on"
    to: "off"
    id: night

  - platform: state
    entity_id: !input day_night
    from: "off"
    to: "on"
    id: day

  - platform: state
    entity_id: !input window_sensor
    to: "open"
    id: window_open

  - platform: state
    entity_id: !input window_sensor
    to: "tilted"
    id: window_tilted

  - platform: state
    entity_id: !input window_sensor
    to: "closed"
    id: window_closed

action:
  ############################################
  # Tag-Werktag-früheste Öffnung
  ############################################
  - if:
      - condition: trigger
        id:
          - earliest_open_workday
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "on"
      - condition: state
        entity_id: !input day_night
        state: "on"
      - condition: state
        entity_id: !input open_off
        state: "off"
    then:
      - device_id: 4e7fdbe800da0e94412a2b5a61585f77
        domain: cover
        entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
        type: set_position
        position: 0
      - service: input_text.set_value
        data:
          value: Der Rolladen wurde automatisch geöffnet (früheste Öffnung)
        target:
          entity_id: !input text_status
      - service: input_select.select_option
        data:
          option: Tag
        target:
          entity_id: !input mode
    alias: Tag-Werktag-früheste Öffnung

  ##############################################
  # Tag-Werktag-zwischen 6:30 und 7:00
  #############################################
  - if:
      - condition: trigger
        id:
          - day
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "on"
      - condition: time
        after: "06:30:00"
        before: "07:00:00"
      - condition: state
        entity_id: !input open_off
        state: "off"
    then:
      - device_id: 4e7fdbe800da0e94412a2b5a61585f77
        domain: cover
        entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
        type: set_position
        position: 0
      - service: input_text.set_value
        data:
          value: Der Rolladen wurde automatisch geöffnet (zwischen früheste und
            späteste Öffnung)
        target:
          entity_id: !input text_status
      - service: input_select.select_option
        data:
          option: Tag
        target:
          entity_id: !input mode
    alias: Tag-Werktag-zwischen 6:30 und 7:00

  ##############################################
  # Tag-Werktag-späteste Öffnung
  ##############################################
  - if:
      - condition: trigger
        id:
          - latest_open_workday
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "on"
      - condition: state
        entity_id: !input open_off
        state: "off"
      - condition: state
        entity_id: !input mode
        state: Nacht
    then:
      - device_id: 4e7fdbe800da0e94412a2b5a61585f77
        domain: cover
        entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
        type: set_position
        position: 0
      - service: input_text.set_value
        data:
          value: Der Rolladen wurde automatisch geöffnet (späteste Öffnung)
        target:
          entity_id: !input text_status
      - service: input_select.select_option
        data:
          option: Tag
        target:
          entity_id: !input mode
    alias: Tag-Werktag-späteste Öffnung

  ###############################################
  # Tag-non-Werktag-früheste Öffnung
  ###############################################
  - if:
      - condition: trigger
        id:
          - earliest_open_non_workday
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "off"
      - condition: state
        entity_id: !input day_night
        state: "on"
      - condition: state
        entity_id: !input open_off
        state: "off"
    then:
      - device_id: 4e7fdbe800da0e94412a2b5a61585f77
        domain: cover
        entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
        type: set_position
        position: 0
      - service: input_text.set_value
        data:
          value: Der Rolladen wurde automatisch geöffnet (früheste Öffnung)
        target:
          entity_id: !input text_status
      - service: input_select.select_option
        data:
          option: Tag
        target:
          entity_id: !input mode
    alias: Tag-non-Werktag-früheste Öffnung

  ###################################################
  # Tag-non-Werktag-zwischen 7:30 und 8:00
  ###################################################
  - if:
      - condition: trigger
        id:
          - day
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "off"
      - condition: time
        after: "07:30:00"
        before: "08:00:00"
      - condition: state
        entity_id: !input open_off
        state: "off"
    then:
      - device_id: 4e7fdbe800da0e94412a2b5a61585f77
        domain: cover
        entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
        type: set_position
        position: 0
      - service: input_text.set_value
        data:
          value: Der Rolladen wurde automatisch geöffnet (zwischen früheste und
            späteste Öffnung)
        target:
          entity_id: !input text_status
      - service: input_select.select_option
        data:
          option: Tag
        target:
          entity_id: !input mode
    alias: Tag-non-Werktag-zwischen 7:30 und 8:00

  ##################################################
  #  Tag-non-Werktag-späteste Öffnung
  ##################################################
  - if:
      - condition: trigger
        id:
          - latest_open_non_workday
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "off"
      - condition: state
        entity_id: !input open_off
        state: "off"
      - condition: state
        entity_id: !input mode
        state: Nacht
    then:
      - device_id: 4e7fdbe800da0e94412a2b5a61585f77
        domain: cover
        entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
        type: set_position
        position: 0
      - service: input_text.set_value
        data:
          value: Der Rolladen wurde automatisch geöffnet (späteste Öffnung)
        target:
          entity_id: !input text_status
      - service: input_select.select_option
        data:
          option: Tag
        target:
          entity_id: !input mode
    alias: Tag-non-Werktag-späteste Öffnung

  ################################################
  # Nacht-Werktag-vor 16:30
  ################################################
  - if:
      - condition: trigger
        id:
          - earliest_close_workday
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "on"
      - condition: state
        entity_id: !input day_night
        state: "off"
      - condition: time
        after: "16:30:00"
      - condition: state
        entity_id: !input close_off
        state: "off"
    then:
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: closed
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 100
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch vollständig geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster geschlossen
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: tilted
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 75
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch teilweise geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster gekippt
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: open
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 0
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde nicht geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster offen
    alias: Nacht-Werktag-vor 16:30

  ######################################################
  # Nacht-Werktag-zwischen 16:30 und 21:00
  ######################################################
  - if:
      - condition: trigger
        id:
          - night
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "on"
      - condition: time
        before: "21:30:00"
        after: "16:30:00"
      - condition: state
        entity_id: !input close_off
        state: "off"
    then:
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: closed
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 100
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch vollständig geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster geschlossen
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: tilted
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 75
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch teilweise geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster gekippt
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: open
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 0
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde nicht geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster offen
    alias: Nacht-Werktag-zwischen 16:30 und 21:00

  ####################################################
  # Nacht-werktag-späteste Schließung
  ####################################################
  - if:
      - condition: trigger
        id:
          - latest_close_workday
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "on"
      - condition: state
        entity_id: !input close_off
        state: "off"
      - condition: state
        entity_id: !input mode
        state: Tag
    then:
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: closed
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 100
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch vollständig geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster geschlossen
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: tilted
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 75
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch teilweise geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster gekippt
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: open
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 0
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde nicht geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster offen
    alias: Nacht-werktag-späteste Schließung

  ##################################################
  # Nacht-non-Werktag-vor 17:00
  ##################################################
  - if:
      - condition: trigger
        id:
          - earliest_close_non_workday
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "on"
      - condition: state
        entity_id: !input day_night
        state: "off"
      - condition: time
        after: "16:30:00"
      - condition: state
        entity_id: !input close_off
        state: "off"
    then:
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: closed
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 100
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch vollständig geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster geschlossen
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: tilted
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 75
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch teilweise geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster gekippt
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: open
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 0
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde nicht geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster offen
    alias: Nacht-non-Werktag-vor 17:00

  ##################################################
  # Nacht-non-Werktag-zwischen 17:00 und 21:30
  ##################################################
  - if:
      - condition: trigger
        id:
          - night
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "off"
      - condition: time
        before: "21:30:00"
        after: "17:00:00"
      - condition: state
        entity_id: !input close_off
        state: "off"
    then:
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: closed
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 100
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch vollständig geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster geschlossen
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: tilted
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 75
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch teilweise geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster gekippt
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: open
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 0
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde nicht geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster offen
    alias: Nacht-non-Werktag-zwischen 17:00 und 21:30

  ########################################################
  # Nacht-non-Werktag-späteste Schließung
  ########################################################
  - if:
      - condition: trigger
        id:
          - latest_close_non_workday
      - condition: state
        entity_id: !input active
        state: on
      - condition: state
        entity_id: !input workday
        state: "off"
      - condition: state
        entity_id: !input close_off
        state: "off"
      - condition: state
        entity_id: !input mode
        state: Tag
    then:
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: closed
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 100
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch vollständig geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster geschlossen
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: tilted
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 75
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde automatisch teilweise geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster gekippt
      - if:
          - condition: state
            entity_id: !input window_sensor
            state: open
        then:
          - device_id: 4e7fdbe800da0e94412a2b5a61585f77
            domain: cover
            entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
            type: set_position
            position: 0
          - service: input_text.set_value
            data:
              value: Der Rolladen wurde nicht geschlossen
            target:
              entity_id: !input text_status
          - service: input_select.select_option
            data:
              option: Nacht
            target:
              entity_id: !input mode
        alias: Fenster offen
    alias: Nacht-non-Werktag-späteste Schließung

    ##########################################
    # Trigger_fenster_offen
    ##########################################
  - if:
      - condition: trigger
        id:
          - window_open
      - condition: state
        entity_id: !input mode
        state: Nacht
      - condition: state
        entity_id: !input close_off
        state: "off"
    then:
      - device_id: 4e7fdbe800da0e94412a2b5a61585f77
        domain: cover
        entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
        type: set_position
        position: 0
    alias: Trigger_fenster_offen

    #########################################
    # Trigger_fenster_gekippt
    #########################################
  - if:
      - condition: trigger
        id:
          - window_titled
      - condition: state
        entity_id: !input mode
        state: Nacht
      - condition: state
        entity_id: !input close_off
        state: "off"
    then:
      - device_id: 4e7fdbe800da0e94412a2b5a61585f77
        domain: cover
        entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
        type: set_position
        position: 70
    alias: Trigger_fenster_gekippt

    #########################################
    # Trigger_fenster_geschlossen
    #########################################
  - if:
      - condition: trigger
        id:
          - window_closed
      - condition: state
        entity_id: !input mode
        state: Nacht
      - condition: state
        entity_id: !input close_off
        state: "off"
    then:
      - device_id: 4e7fdbe800da0e94412a2b5a61585f77
        domain: cover
        entity_id: e1355bc1b900e93ffca4406ecc0ff9f1
        type: set_position
        position: 100
    alias: Trigger_fenster_geschlossen
